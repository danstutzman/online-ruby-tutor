!!!html
%html
  %head
    / requirements for pytutor.js
    %script(src='/js/d3.v2.min.js')
    %script(src='/js/jquery-1.8.2.min.js')
    %script(src='/js/jquery.ba-bbq.min.js')
    %script(src='/js/jquery.jsPlumb-1.3.10-all-min.js')
    %script(src='/js/jquery-ui-1.8.24.custom.min.js')
    %script(src='/js/pytutor.js')
    %link(href='/css/pytutor.css' rel='stylesheet')

    / codemirror.net online code editor
    %script(src='/js/codemirror.js')
    %link(href='/css/codemirror.css' rel='stylesheet' type='text/css')
    %script(src='/js/codemirror-ruby.js')

    - if @traces
      %script
        != "var traces_json = #{JSON.dump(@traces).inspect};"

    %script(src='/js/online-ruby-tutor.js')
    :css
      div.ExecutionVisualizer table#pyCodeOutput {
        margin: 0 0;
      }
      #trace_render_div_cover {
        position:absolute;
        z-index:99;
        width:100px;
        height:100px;
        background-color:#000000;
        opacity:0.1;
        display:none;
      }
      table {
        border-collapse: collapse;
        margin: 20px 0;
      }
      th, td {
        padding: 0px 5px;
      }
      body {
        font-family: sans-serif;
      }
      tr.headers th {
        background-color: gray;
        color: white;
      }
      #traces-table {
        cursor: pointer;
      }
      #traces-table tr.selectedRow {
        background-color: #faa;
      }
      .failed {
         color:red;
         display:inline-block;
         width:60px
      }
      .passed {
         color:green;
         display:inline-block;
         width:60px
      }

  %body
    %form(method='post')
      - if @exercise
        %b
          Exercise
          = "#{params['exercise_num']}:"
          = @exercise['description']
        %br
        %table#traces-table
          %tr.headers
            %th Given
            %th Expected
            %th Actual
            %th Result
            %td{ :rowspan => @exercise['cases'].size + 1 }
              %button(style='height:100%') Run
          - @exercise['cases'].each_with_index do |_case, i|
            %tr{ :'data-trace-num' => i }
              %td
                %code= _case['given'].map { |var, val| "#{var} = #{val}" }.join(', ')
              %td
                %code= _case['expected']
              %td
                %code= (@traces ? @traces[i]['returned'] : nil).inspect
              %td
                - if (@traces ? @traces[i]['returned'] : nil) == _case['expected']
                  .passed PASSED
                - else
                  .failed FAILED
        %hr

        #user_code_div
          %textarea#user_code_textarea(name='user_code_textarea'
                                       cols='40' rows='20')
            = params["user_code_textarea"]
      #trace_render_div_cover
      - if @traces
        - @traces.each_with_index do |trace, i|
          %div{ :id => "trace_render_div#{i}", :class => 'trace_render_div' }
